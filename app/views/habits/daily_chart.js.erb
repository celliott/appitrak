$('#habit_chart_content').html("<%= j render(:partial => 'daily_chart') %>");
 
$(document).ready(function() {
	$("#trends_dropdown").val('<%= cookies[:trend] %>');
	Morris.Line({
	  element: 'habit_chart',
	  data: [
	  <% @start_date.upto(@end_date).each do |date| %>
  	  <% daily_habits = HabitsUser.where("user_id=?", @current_user_id).collect {|i| i.habit_id} %>
      <% @habits = Habit.order("name ASC").where(:id => daily_habits) %>
      	{ d: '<%= date %>',
      <% @habits.each do |habit| %>
      	<% daily_count = HabitsUser.where("user_id=? AND habit_id = ? AND DATE(created_at) = DATE(?)", @current_user_id, habit.id, date).count %>
   				h<%= habit.id%>: <%= daily_count %>,
				<% end %>
				},
  	<% end %>	
		],
	  xkey: 'd',
	  ykeys: [
	    <% @habits.each do |habit| %>
	    'h<%= habit.id%>',
	    <% end %>
	  ],
	  xLabelFormat: function(d) {
      return (d.getMonth()+1)+'/'+d.getDate(); 
    },
	  labels: [
	    <% @habits.each do |habit| %>
	      '<%= habit.name%>',
	    <% end %>
	  ],	
	  xLabel: 'day',	  
	  hideHover: 'auto',
	});
});