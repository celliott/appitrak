$('#habit_chart_content').html("<%= j render(:partial => 'daily_chart') %>");
 
$(document).ready(function() {
	$("#trends_dropdown").val('<%= cookies[:trend] %>');
	Morris.Line({
	  element: 'habit_chart',
	  data: [
	  <% @start_date.upto(@end_date).each do |date| %>
      	{ d: '<%= date %>',
      <% @habits.each do |habit| %>
        <% @habit_types = UsersHabit.where('user_id=? AND habit_id=?', @current_user_id, habit.id).count %>
      	<% daily_count = HabitsUser.where("user_id=? AND habit_id = ? AND DATE(created_at) = DATE(?)", @current_user_id, habit.id, date).count %>
      	  <%if @habit_types > 0 %>
   				  h<%= habit.id%>: <%= daily_count %>,
				  <% end %>
				<% end %>
				},
  	<% end %>	
		],
	  xkey: 'd',
	  ykeys: [
	    <% @habits.each do |habit| %>
	      <% @habit_types = UsersHabit.where('user_id=? AND habit_id=?', @current_user_id, habit.id).count %>
	      <%if @habit_types > 0 %>
	        'h<%= habit.id%>',
	      <% end %> 
	    <% end %>
	  ],
	  xLabelFormat: function(d) {
      return (d.getMonth()+1)+'/'+d.getDate(); 
    },
	  labels: [
	    <% @habits.each do |habit| %>
	      <% @habit_types = UsersHabit.where('user_id=? AND habit_id=?', @current_user_id, habit.id).count %>
	      <%if @habit_types > 0 %>
	        '<%= habit.name%>',
	      <% end %>  
	    <% end %>
	  ],	
	  xLabel: 'day',	  
	  hideHover: 'auto',
	});
});